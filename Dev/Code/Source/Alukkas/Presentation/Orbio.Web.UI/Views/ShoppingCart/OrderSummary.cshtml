@model List<Orbio.Web.UI.Models.Orders.ShoppingCartProductDetailModel>

@{
    var count = 0;

    foreach (var scpd in this.Model)
    {
        var scpdr = string.Format("Products[{0}].IsRemove", count);
        var scpdqu = string.Format("Products[{0}].SelectedQuantity", count);
        var scpdId = string.Format("Products[{0}].Id", count);
        var scpdTotalprice = string.Format("Products[{0}].Totalprice", count);
        var scpdRemove = string.Format("Products[{0}].IsRemove", count);
        var scpdQuantity = string.Format("Products[{0}].SelectedQuantity", count);
        var scpdcartid = string.Format("Products[{0}].CartId", count);
        <tr>
            <td><img src="@scpd.DefaultPicture.ImageUrl"></td>
            <td>@scpd.Name </td>
            <td>@Html.CheckBox(scpdr,scpd.IsRemove)@*<input type="checkbox" name="Remove" value="@scpd.CartId" />*@</td>
            <td>
                @{
        var qtyList = new List<object>();
        if (scpd.AllowedQuantities.Count > 0)
        {
            foreach (var qty in scpd.AllowedQuantities)
            {
                qtyList.Add(new { Text = qty.ToString(), Value = qty.ToString() });
            }
        }
        else
        {
            for (var i = scpd.OrderMinimumQuantity; i <= scpd.OrderMaximumQuantity; i++)
            {
                qtyList.Add(new { Text = i.ToString(), Value = i.ToString() });
            }
        }
        //var selectedValue = qtyList.Where(qty => qty == scpd.SelectedQuantity).FirstOrDefault();
        //if (selectedValue == null)
        //{
        //    selectedValue = qtyList.FirstOrDefault();
        //}
        var qtySelectList = new SelectList(qtyList, "Value", "Text", scpd.SelectedQuantity);
                }
               
                @Html.DropDownList(scpdqu, (IEnumerable<SelectListItem>)qtySelectList)
                @Html.Hidden(scpdRemove, scpd.IsRemove)  @Html.Hidden(scpdQuantity, scpd.SelectedQuantity) @Html.Hidden(scpdcartid, scpd.CartId)
            <td>@scpd.CurrencyCode.@scpd.ProductPrice.Price @Html.Hidden(scpdId, scpd.Id)  @Html.Hidden(scpdTotalprice, scpd.Totalprice)</td>
            <td>@scpd.CurrencyCode.@scpd.Totalprice @Html.Hidden(scpd.Totalprice)</td>
        </tr>
        count++;
    }
}